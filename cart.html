<!DOCTYPE html>
<html lang="en">
<head>
            <link rel="icon" href="logo Teluge.jpg" type="image/x-icon">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teluge Agro - Cart & Checkout</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');
    body {
      background: linear-gradient(to bottom, #E8F5E9 0%, #FFFFFF 100%);
      font-family: 'Quicksand', sans-serif;
    }
    .text-shadow-green {
      text-shadow: 0 2px 4px rgba(76, 175, 80, 0.5);
    }
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
      -webkit-appearance: none; 
      margin: 0; 
    }
    /* Responsive table for mobile */
    @media (max-width: 640px) {
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      thead {
        display: none;
      }
      tbody tr {
        display: block;
        border-bottom: 1px solid #c6f6d5;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
      }
      tbody tr td {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
      }
      tbody tr td:nth-child(1)::before {
        content: "Product: ";
        font-weight: 600;
        color: #2f855a;
      }
      tbody tr td:nth-child(2)::before {
        content: "Price: ";
        font-weight: 600;
        color: #2f855a;
      }
      tbody tr td:nth-child(3)::before {
        content: "Quantity: ";
        font-weight: 600;
        color: #2f855a;
      }
      tbody tr td:nth-child(4)::before {
        content: "Subtotal: ";
        font-weight: 600;
        color: #2f855a;
      }
      tbody tr td:nth-child(5)::before {
        content: "Remove: ";
        font-weight: 600;
        color: #2f855a;
      }
      tbody tr td input.quantity-input {
        max-width: 60px;
      }
      tbody tr td button.remove-btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }
      .text-right {
        text-align: left !important;
      }
      .text-xl {
        font-size: 1.125rem !important;
      }
      #checkout-btn {
        width: 100%;
        padding: 1rem 0;
        font-size: 1.125rem;
      }
    }
  </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">
    <header class="bg-green-700 text-white py-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center px-4 relative">
            <div class="flex items-center space-x-2">
                <img src="logo Teluge.jpg" alt="Green leaf icon symbolizing nature and agriculture, stylized as a fresh plant leaf in vibrant green hues" class="w-8 h-8 rounded-full placeholder-img">
                <h1 class="text-2xl font-bold text-shadow-green">Teluge Agro</h1>
            </div>
            <button id="hamburger-btn" aria-label="Toggle menu" class="md:hidden focus:outline-none z-30">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>
            <nav id="nav-menu" class="hidden md:flex space-x-6 text-white font-semibold">
                <a href="leadingpage.html" class="hover:text-green-300">About</a>
                <a href="#products" class="hover:text-green-300">Products</a>
    
                <a href="store.html" class="text-green-300 font-bold border-b-2 border-white">Store</a>
                <a href="cart.html" id="cart-link" class="hover:text-green-300 relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
                    </svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </nav>
            <!-- Mobile menu -->
            <nav id="mobile-menu" class="hidden bg-green-600 text-white px-4 py-2 md:hidden flex flex-col space-y-2 absolute top-full right-4 rounded shadow-lg z-20 w-40">
                <a href="leadingpage.html" class="hover:text-green-300">About</a>
                <a href="#products" class="hover:text-green-300">Products</a>
          
             <a href="store.html" class="hover:text-green-300">Store</a>
            <a href="cart.html" id="cart-link" class="hover:text-green-300 relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
                    </svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </nav>
        </div>
    </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-10 flex-grow">
    <h2 class="text-3xl font-semibold text-green-800 mb-8 text-center">Keranjang Belanja Mu </h2>
    <div id="cart-container" class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="border-b border-green-300">
            <th class="py-2">Product</th>
            <th class="py-2 w-24">Price</th>
            <th class="py-2 w-24">Quantity</th>
            <th class="py-2 w-24">Subtotal</th>
            <th class="py-2 w-16">Remove</th>
          </tr>
        </thead>
        <tbody id="cart-items">
          <!-- Cart items inserted here -->
        </tbody>
      </table>
      <div class="text-right mt-6">
        <p class="text-xl font-bold text-green-700">Total: Rp<span id="cart-total">0.00</span></p>
      </div>
      <div class="mt-8 text-center">
        <button id="checkout-btn" class="bg-green-600 text-white px-8 py-3 rounded-full font-bold hover:bg-green-700 transition disabled:opacity-50" disabled>Proceed to Checkout</button>
      </div>
    </div>

    <!-- Checkout Form Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
      <div class="bg-white rounded-lg max-w-lg w-full p-8 relative">
        <button id="close-modal" class="absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-2xl font-bold">&times;</button>
        <h3 class="text-2xl font-bold text-green-800 mb-6 text-center">Checkout</h3>
        <form id="checkout-form" class="space-y-4">
          <div>
            <label for="name" class="block font-semibold mb-1">Full Name</label>
            <input type="text" id="name" name="name" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
          </div>
          <div>
            <label for="email" class="block font-semibold mb-1">Email Address</label>
            <input type="email" id="email" name="email" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
          </div>
          <div>
            <label for="address" class="block font-semibold mb-1">Shipping Address</label>
            <textarea id="address" name="address" rows="3" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
          </div>
          <div>
            <label for="payment" class="block font-semibold mb-1">Payment Method</label>
            <select id="payment" name="payment" required class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
              <option value="" disabled selected>Select a payment method</option>
              <option value="credit_card">Credit Card (Simulated)</option>
              <option value="paypal">PayPal (Simulated)</option>
            </select>
          </div>
          <div class="text-center mt-6">
            <button type="submit" class="bg-green-600 text-white px-8 py-3 rounded-full font-bold hover:bg-green-700 transition">Pay Now</button>
          </div>
        </form>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-4 text-center">
    <p>Â© 2017 Teluge Agro. All rights reserved.</p>
  </footer>

  <!-- Cart Popup -->
  <div id="cart-popup" class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-full shadow-lg cursor-pointer hidden z-50">
    <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
    </svg>
    <span id="popup-count">0</span> items in cart
  </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB2sLqWwZIxr65c3CcNgKCCjmDTeDlSnfY",
            authDomain: "telugeagro2025.firebaseapp.com",
            projectId: "telugeagro2025",
            storageBucket: "telugeagro2025.firebasestorage.app",
            messagingSenderId: "1029963109637",
            appId: "1:1029963109637:web:86824d0db45e1489b3136c",
            measurementId: "G-XF1JDPME66"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    let cartItems = {}; // Will store cart as object with product names as keys

    const cartItemsTbody = document.getElementById('cart-items');
    const cartTotalSpan = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkoutModal = document.getElementById('checkout-modal');
    const closeModalBtn = document.getElementById('close-modal');
    const checkoutForm = document.getElementById('checkout-form');

    // Load cart from localStorage
    function loadCart() {
      const cartData = localStorage.getItem('cart');
      console.log('Raw cart data from localStorage:', cartData);
      cartItems = JSON.parse(cartData) || {};
      console.log('Parsed cart items:', cartItems);
      renderCart();
    }

    // Save cart to localStorage
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cartItems));
    }

    // Update item quantity
    function updateItemQuantity(productName, newQuantity) {
      if (newQuantity <= 0) {
        delete cartItems[productName];
      } else {
        cartItems[productName].quantity = newQuantity;
      }
      saveCart();
      renderCart();
    }

    // Remove item from cart
    function removeItem(productName) {
      delete cartItems[productName];
      saveCart();
      renderCart();
    }

    // Clear cart
    function clearCart() {
      cartItems = {};
      saveCart();
      renderCart();
    }

    function renderCart() {
      cartItemsTbody.innerHTML = '';
      const items = Object.values(cartItems);

      // Update cart count badge
      const cartCount = items.reduce((acc, item) => acc + item.quantity, 0);
      const cartCountElem = document.getElementById('cart-count');
      const cartCountMobileElem = document.getElementById('cart-count-mobile');
      if (cartCountElem) cartCountElem.textContent = cartCount;
      if (cartCountMobileElem) cartCountMobileElem.textContent = cartCount;

      // Update popup
      const popup = document.getElementById('cart-popup');
      const popupCount = document.getElementById('popup-count');
      if (cartCount > 0) {
        popup.classList.remove('hidden');
        popupCount.textContent = cartCount;
      } else {
        popup.classList.add('hidden');
      }

        if (items.length === 0) {
          cartItemsTbody.innerHTML = '<tr><td colspan="5" class="text-center py-6 text-gray-500">Keranjang mu kosong.</td></tr>';
          cartTotalSpan.textContent = '0.000';
          checkoutBtn.disabled = true;
          return;
        }

        checkoutBtn.disabled = false;
        let total = 0;
        items.forEach((item, index) => {
          const subtotal = item.price * item.quantity;
          total += subtotal;
          const tr = document.createElement('tr');
          tr.classList.add('border-b', 'border-green-300');
          tr.innerHTML = `
            <td class="py-3">${item.product}</td>
            <td class="py-3">Rp${item.price.toFixed(3)}</td>
            <td class="py-3">
              <input type="number" min="1" value="${item.quantity}" data-product="${item.product}" class="quantity-input w-16 border border-gray-300 rounded px-2 py-1" />
            </td>
            <td class="py-3">Rp${subtotal.toFixed(3)}</td>
            <td class="py-3 text-center">
              <button data-product="${item.product}" class="remove-btn bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Remove</button>
            </td>
          `;
          cartItemsTbody.appendChild(tr);
        });
        cartTotalSpan.textContent = total.toFixed(3);
    }

    function attachEventListeners() {
      // Use event delegation for better performance and to avoid duplicate event listeners
      cartItemsTbody.addEventListener('change', (e) => {
        if (e.target.classList.contains('quantity-input')) {
          const productName = e.target.dataset.product;
          let val = parseInt(e.target.value);
          if (isNaN(val) || val < 1) val = 1;
          updateItemQuantity(productName, val);
        }
      });

      cartItemsTbody.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-btn')) {
          const productName = e.target.dataset.product;
          removeItem(productName);
        }
      });
    }

    // Attach event listeners
    attachEventListeners();

    checkoutBtn.addEventListener('click', () => {
      checkoutModal.classList.remove('hidden');
    });

    closeModalBtn.addEventListener('click', () => {
      checkoutModal.classList.add('hidden');
    });

    // Close modal on outside click
    window.addEventListener('click', e => {
      if (e.target === checkoutModal) {
        checkoutModal.classList.add('hidden');
      }
    });

    checkoutForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      // Simulate payment processing
      const name = checkoutForm.name.value.trim();
      const email = checkoutForm.email.value.trim();
      const address = checkoutForm.address.value.trim();
      const payment = checkoutForm.payment.value;

      if (!name || !email || !address || !payment) {
        alert('Please fill all fields and select a payment method.');
        return;
      }

      // Simulate payment gateway delay
      checkoutBtn.disabled = true;
      checkoutBtn.textContent = 'Processing...';

      try {
        // Prepare order data
        const items = Object.values(cartItems);
        const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);

        const orderData = {
          userId: email, // Using email as user ID for simplicity
          customerName: name,
          email: email,
          address: address,
          paymentMethod: payment,
          items: items,
          total: total,
          timestamp: new Date(),
          status: 'pending'
        };

        // Save order to Firestore
        await db.collection('orders').add(orderData);

        alert(`Thank you, ${name}! Your payment via ${payment.replace('_', ' ')} was successful.\nYour order will be shipped to:\n${address}\n\nOrder details have been saved and can be viewed in the admin panel.`);

        // Clear cart
        clearCart();
        checkoutForm.reset();
        checkoutModal.classList.add('hidden');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = 'Proceed to Checkout';
      } catch (error) {
        console.error('Error saving order:', error);
        alert('There was an error processing your order. Please try again.');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = 'Proceed to Checkout';
      }
    });

    // Hamburger menu toggle
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    hamburgerBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // Close mobile menu when clicking on a link
    mobileMenu.addEventListener('click', (e) => {
      if (e.target.tagName === 'A') {
        mobileMenu.classList.add('hidden');
      }
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!hamburgerBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
        mobileMenu.classList.add('hidden');
      }
    });

    // Initialize the app
    loadCart();

    // Popup click event
    document.getElementById('cart-popup').addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>


