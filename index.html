<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teluge Agro - Banana Suplayer</title>
  <link rel="icon" href="logo Teluge.jpg" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');
    body {  
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(135deg, #86efac, #4ade80);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }
    .container {
      background: white;
      border-radius: 1.5rem;
      box-shadow: 0 25px 40px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 380px; /* Lebih sempit untuk tampilan portrait */
      min-height: 600px; /* Tinggi untuk portrait */
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1.5rem;
      margin: 0 auto;
    }
    
 
    @media (min-width: 768px) {
      .container {
        max-width: 600px;
        padding: 3rem 2rem 3.5rem;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      p.desc {
        font-size: 1.1rem;
        margin-bottom: 2.5rem;
      }
      
      .avatar {
        width: 120px;
        height: 120px;
        margin-bottom: 1.5rem;
      }
      
      button.link-btn {
        padding: 1rem 2rem;
        font-size: 1.2rem;
      }
      
      button.link-btn img {
        width: 32px;
        height: 32px;
      }
    }
    
    /* Mobile optimization */
    @media (max-width: 480px) {
      .container {
        width: 95%;
        padding: 1.5rem 1rem 2rem;
        border-radius: 1rem;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      p.desc {
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
      }
      
    .avatar {
      width: 80px;
      height: 80px;
      margin-bottom: 1rem;
    }
      
      button.link-btn {
        padding: 0.75rem 1.25rem;
        font-size: 1rem;
      }
      
      button.link-btn img {
        width: 24px;
        height: 24px;
      }
      
      .share-btn {
        width: 40px;
        height: 40px;
        top: 0.5rem;
        right: 0.5rem;
      }
      
      .share-btn svg {
        width: 20px;
        height: 20px;
      }
    }
    
    /* Base styles */
    .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 4px solid #34d399;
      overflow: hidden;
      margin-bottom: 1.25rem;
      box-shadow: 0 4px 8px rgb(56 189 138 / 0.35);
      transition: transform 0.3s ease;
      cursor: pointer;
      background-color: #3b82f6;
      color: white;
      font-weight: bold;
      font-size: 48px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 10px 15px rgb(52 211 153 / 0.6);
    }
    h1 {
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    p.desc {
      font-weight: 500;
      color: #065f46;
      font-size: 1rem;
      text-align: center;
      margin-bottom: 2rem;
      line-height: 1.4;
    }
    .links {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    button.link-btn {
      cursor: pointer;
      display: flex;
      align-items: center;
      background: #22c55e;
      color: white;
      font-weight: 600;
      padding: 0.85rem 1.5rem;
      border-radius: 9999px;
      border: none;
      font-size: 1.1rem;
      box-shadow: 0 6px 10px rgb(34 197 94 / 0.3);
      transition:
        background-color 0.3s ease,
        box-shadow 0.3s ease,
        transform 0.3s ease;
    }
    button.link-btn:hover, button.link-btn:focus {
      background-color: #16a34a;
      box-shadow: 0 12px 20px rgb(22 163 74 / 0.6);
      transform: translateY(-2px);
      outline: none;
    }
    button.link-btn img {
      width: 28px;
      height: 28px;
      border-radius: 0.375rem;
      margin-right: 1rem;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.15));
      transition: transform 0.3s ease;
    }
    button.link-btn:hover img {
      transform: scale(1.15);
    }
    footer {
      margin-top: 2.5rem;
      font-size: 0.85rem;
      color: #065f46cc;
      user-select: none;
    }

    .share-btn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: white;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
      border: 2px solid transparent;
    }
    .share-btn:hover {
      background-color: #4ade80;
      border-color: #22c55e;
    }
    .share-btn svg {
      width: 24px;
      height: 24px;
      stroke: #065f46;
      stroke-width: 2.3;
      stroke-linecap: round;
      stroke-linejoin: round;
      transition: stroke 0.3s ease;
    }
    .share-btn:hover svg {
      stroke: white;
    }
 
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: #4ade80;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 8px 15px rgba(34,197,94,0.7);
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 99;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
    }

    .drag-handle {
      flex-shrink: 0;
      width: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Circular plus button */
    #addServiceBtnOutside {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #357a38;
      color: white;
      font-size: 36px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #addServiceBtnOutside:hover {
      background-color: #2c5d2e;
    }
  </style>
</head>
<body>
  <button aria-label="Bagikan Profil" title="Bagikan Profil" class="share-btn" id="shareBtn">
    <svg fill="none" viewBox="0 0 24 24" aria-hidden="true" >
      <path d="M4 12v1a3 3 0 003 3h10M16 8l5-5m0 0l-5-5m5 5H9" />
    </svg>
  </button>

  <main role="main" class="container" aria-label="Profil bio TeluGe Agro">
    <div class="avatar" tabindex="0" aria-label="Logo perusahaan TeluGe Agro">
      <img src="logo Teluge.jpg" alt="Logo Teluge Agro" style="width: 100%; height: 100%; object-fit: contain; border-radius: 50%;" />
    </div>

    <h1>@telugeagro</h1>
    <p class="desc">Supplier Pisang Dan Spesialis - Good Bananas Supplier & Specialist Until Export, Purworejo Central Java ID</p>

    <nav class="links" aria-label="Tautan Aplikasi dan Media Sosial">
      <button class="link-btn" onclick="openLink('https://www.tokopedia.com/telugeagro')" aria-label="Buka Tokopedia TeluGe Agro">
        <img src="Logo Tokopedia (1).png" alt="Logo hijau Tokopedia berbentuk burung hantu" onerror="this.onerror=null; this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/d597cd25-28d1-487d-abd7-4e7cc6d246f0.png';"/>
        Tokopedia
      </button>
      <button class="link-btn" onclick="openLink('https://shopee.co.id/t3luge_agro?is_from_login=true')" aria-label="Buka Shopee TeluGe Agro">
        <img src="Logo Shopee.png" alt="Logo oranye Shopee berupa tas belanja" onerror="this.onerror=null; this.src='https://placehold.co/28x28/png?text=Error';"/>
        Shopee
      </button>
      <button class="link-btn" onclick="openLink('https://www.instagram.com/teluge_agro?igsh=cXR3YWtxaDNnYjJw')" aria-label="Buka Instagram TeluGe Agro">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Logo Instagram berwarna gradasi merah, ungu, dan oranye membentuk kamera" onerror="this.onerror=null; this.src='https://placehold.co/28x28/png?text=Error';"/>
        Instagram
      </button>
      <button class="link-btn" onclick="openWhatsApp()" aria-label="Hubungi WhatsApp TeluGe Agro">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="Logo WhatsApp berwarna hijau" onerror="this.onerror=null; this.src='https://placehold.co/28x28/png?text=Error';"/>
        WhatsApp
      </button>
      <button class="link-btn" onclick="openLink('https://www.facebook.com/TelugeAgro?rdid=ba1ZrBdIXWKmtGmH&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2F1CPJqr4wzQ%2F%23')" aria-label="Buka Facebook TeluGe Agro">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Logo Facebook berwarna biru" onerror="this.onerror=null; this.src='https://placehold.co/28x28/png?text=Error';"/>
        Facebook
      </button>
      <button class="link-btn" onclick="openLink('https://www.google.com/maps/place/Teluge+Agro+-+Supplier+Pisang+dan+Spesialis/@-7.7408703,109.9370574,692m/data=!3m2!1e3!4b1!4m6!3m5!1s0x2e7ac390dce0a6eb:0xf0cb3eb8af2c7312!8m2!3d-7.7408703!4d109.9370574!16s%2Fg%2F11hfg1m849?entry=ttu&g_ep=EgoyMDI5MDgyNS4wIKXMDSoASAFQAw%3D%3D')" aria-label="Buka Google Maps TeluGe Agro">
        <img src="Logo Maps.png" alt="Logo Google Maps berwarna merah" onerror="this.onerror=null; this.src='https://placehold.co/28x28/png?text=Error';"/>
        Google Maps
      </button>
    </nav>

   
    <button id="addServiceBtnOutside" aria-label="Tambah Layanan" title="Tambah Layanan">+</button>

  </main>



  <div id="serviceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-60" role="dialog" aria-modal="true" aria-labelledby="serviceModalTitle">
    <div class="bg-white rounded-lg shadow-lg p-6 w-80 max-w-full relative">
      <h2 id="serviceModalTitle" class="text-lg font-bold mb-4 text-green-700">Edit Layanan</h2>
      <form id="serviceForm" class="flex flex-col gap-4" novalidate>
        <label for="serviceTitle" class="font-semibold text-green-600">Judul Layanan</label>
        <input type="text" id="serviceTitle" name="serviceTitle" required class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        
        <label for="serviceUrl" class="font-semibold text-green-600">URL Tujuan</label>
        <input type="url" id="serviceUrl" name="serviceUrl" required class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        
        <label for="serviceLogo" class="font-semibold text-green-600">URL Logo</label>
        <input type="url" id="serviceLogo" name="serviceLogo" class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        
        <img id="logoPreview" src="" alt="Preview Logo" class="w-16 h-16 rounded mt-2 object-contain border border-gray-300" />
        
        <div class="flex justify-end gap-3 mt-4">
          <button type="button" id="cancelServiceBtn" class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition">Batal</button>
          <button type="submit" id="saveServiceBtn" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700 transition">Simpan</button>
        </div>
      </form>
      <button id="closeServiceModal" aria-label="Close modal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 font-bold text-xl">&times;</button>
    </div>
  </div>

<div id="adminMenu" class="hidden absolute w-60 bg-white rounded-xl shadow-xl border border-gray-200 z-50">

    <div class="p-4 border-b border-gray-100">
      <p class="text-sm font-semibold text-gray-800">TelugeAgro_Admin</p>
      <p class="text-xs text-gray-400">Admin Panel</p>
    </div>

    <div class="flex flex-col">
      <button onclick="manageWeb()" 
        class="flex items-center gap-2 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3a.75.75 0 01.75.75V6a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75V3.75A.75.75 0 016 3h3.75zM18 3.75A.75.75 0 0017.25 3H13.5a.75.75 0 00-.75.75V6a.75.75 0 00.75.75h3.75A.75.75 0 0018 6V3.75zM9.75 13.5a.75.75 0 01.75.75V18a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75v-3.75A.75.75 0 016 13.5h3.75zM18 13.5a.75.75 0 00-.75.75V18a.75.75 0 00.75.75h3.75a.75.75 0 00.75-.75v-3.75a.75.75 0 00-.75-.75H18z" />
        </svg>
        Manage Web
      </button>
      <button id="addServiceBtn" 
        class="flex items-center justify-center gap-2 px-4 py-3 text-white bg-blue-600 rounded-full hover:bg-blue-700 transition w-12 h-12 mx-auto">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
      </button>
      <button onclick="logoutAdmin()" 
        class="flex items-center gap-2 px-4 py-3 text-red-600 hover:bg-red-50 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-9A2.25 2.25 0 002.25 5.25v13.5A2.25 2.25 0 004.5 21h9a2.25 2.25 0 002.25-2.25V15M12 9l3-3m0 0l3 3m-3-3v12" />
        </svg>
        Logout
      </button>
    </div>
  </div>

<script>
  function manageWeb() {
    showToast("Mode editing diaktifkan");
    toggleEditingMode();
    hideAdminMenu();
  }

    function logoutAdmin() {
      localStorage.removeItem('adminLoggedIn');
      showToast("Logout berhasil");
      hideAdminMenu();
      
      // Reset login state and show login modal if account button is clicked again
      const accountBtn = document.getElementById('accountBtn');
      const avatar = document.querySelector('.avatar');
      
      // Update event listeners to show login modal instead of admin menu
      accountBtn.onclick = showLoginModal;
      if (avatar) {
        avatar.onclick = showLoginModal;
      }
    }


</script>

  <!-- Admin Account Button -->
  <button id="accountBtn" aria-label="Account Menu" title="Account Menu" class="share-btn" style="top: 5rem; right: 1rem;">
    <svg fill="none" viewBox="0 0 24 24" aria-hidden="true" >
      <circle cx="12" cy="7" r="4" stroke="#065f46" stroke-width="2"/>
      <path d="M5 21c0-3 6-3 7-3s7 0 7 3" stroke="#065f46" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>


  <div id="loginModal" role="dialog" aria-modal="true" aria-labelledby="loginTitle" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg p-6 w-80 max-w-full shadow-lg">
      <h2 id="loginTitle" class="text-xl font-bold mb-4 text-center text-green-700">Admin Login</h2>
      <form id="loginForm" class="flex flex-col gap-4">
        <label for="username" class="font-semibold text-green-600">Username</label>
        <input type="text" id="username" name="username" required class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        <label for="password" class="font-semibold text-green-600">Password</label>
        <input type="password" id="password" name="password" required class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        <button type="submit" class="bg-green-600 text-white rounded py-2 font-semibold hover:bg-green-700 transition">Login</button>
        <button type="button" id="loginCancel" class="mt-2 text-center text-green-600 hover:underline">Cancel</button>
      </form>
      <p id="loginError" class="text-red-600 mt-2 hidden" role="alert"></p>
    </div>
  </div>

  <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>

  <script>

    const ADMIN_USERNAME = 'teluge@admin.app';
    const ADMIN_PASSWORD = 'teluge2025';

    const accountBtn = document.getElementById('accountBtn');
    const loginModal = document.getElementById('loginModal');
    const loginForm = document.getElementById('loginForm');
    const loginCancel = document.getElementById('loginCancel');
    const loginError = document.getElementById('loginError');

    function isLoggedIn() {
      return localStorage.getItem('adminLoggedIn') === 'true';
    }

    function showLoginModal() {
      loginError.classList.add('hidden');
      loginForm.reset();
      loginModal.classList.remove('hidden');
    }

    function hideLoginModal() {
      loginModal.classList.add('hidden');
    }


    accountBtn.addEventListener('click', () => {
      if (isLoggedIn()) {
        toggleAdminMenu();
      } else {
        showLoginModal();
      }
    });

    // Add click event to avatar for toggling admin menu
    const avatar = document.querySelector('.avatar');
    if (avatar) {
      avatar.addEventListener('click', () => {
        if (isLoggedIn()) {
          toggleAdminMenu();
        } else {
          showLoginModal();
        }
      });
    }

    loginCancel.addEventListener('click', () => {
      hideLoginModal();
    });

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = loginForm.username.value.trim();
      const password = loginForm.password.value.trim();

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        localStorage.setItem('adminLoggedIn', 'true');
        hideLoginModal();
        showToast('Login berhasil!');
        toggleAdminMenu();
      } else {
        loginError.textContent = 'Username atau password salah.';
        loginError.classList.remove('hidden');
      }
    });

 
    let adminMenu;

    function toggleAdminMenu() {
      if (!adminMenu) {
        createAdminMenu();
      }

      if (adminMenu.style.display === 'none' || adminMenu.classList.contains('minimized')) {
    
        adminMenu.style.display = 'block';
        adminMenu.classList.remove('minimized');
        
       
        const accountBtnRect = document.getElementById('accountBtn').getBoundingClientRect();
        const menuWidth = 200; 
        const menuHeight = adminMenu.offsetHeight || 100; // approximate height

       
        let top = accountBtnRect.bottom + 6; // 6px margin below account button

        // Align menu's right edge with account button's right edge
        let right = window.innerWidth - accountBtnRect.right; // calculate right position

        // Ensure menu does not overflow viewport vertically
        if (top + menuHeight > window.innerHeight - 10) {
          top = accountBtnRect.top - menuHeight - 6; // position above account button with margin
          if (top < 10) {
            top = 10; // fallback minimum margin from top viewport edge
          }
        }

        // Apply fixed positioning with right and top offsets
        adminMenu.style.position = 'fixed';
        adminMenu.style.top = top + 'px';
        adminMenu.style.right = right + 'px';
        adminMenu.style.left = 'auto'; // reset left to auto to avoid conflicts

        // Add click outside handler to close menu
        setTimeout(() => {
          document.addEventListener('click', handleClickOutside);
        }, 0);
      } else {
        // Hide admin menu
        hideAdminMenu();
      }
    }

    function hideAdminMenu() {
      if (adminMenu) {
        adminMenu.style.display = 'none';
        adminMenu.classList.add('minimized');
        document.removeEventListener('click', handleClickOutside);
      }
    }

    function handleClickOutside(event) {
      if (adminMenu && adminMenu.style.display === 'block') {
        const isClickInsideMenu = adminMenu.contains(event.target);
        const isClickOnAccountBtn = event.target === accountBtn || accountBtn.contains(event.target);
        
        if (!isClickInsideMenu && !isClickOnAccountBtn) {
          hideAdminMenu();
        }
      }
    }

    let editingMode = false;

    function toggleEditingMode() {
      editingMode = !editingMode;
      const container = document.querySelector('.container');
      const linksContainer = container.querySelector('.links');
      const avatarImg = container.querySelector('.avatar img');
      const mainTitle = container.querySelector('h1');
      const desc = container.querySelector('p.desc');

      if (editingMode) {
        showToast('Editing mode enabled');

        // Enable contenteditable for main title and description
        mainTitle.setAttribute('contenteditable', 'true');
        desc.setAttribute('contenteditable', 'true');

        // Enable drag and drop for links container buttons
        enableDragAndDropLinks(linksContainer);

        // Enable inline editing for link buttons text
        linksContainer.querySelectorAll('button.link-btn').forEach(btn => {
          btn.setAttribute('contenteditable', 'true');
          btn.style.outline = '1px dashed #34d399';
          
          // Add edit icon to each service button
          if (!btn.querySelector('.edit-icon')) {
            const editIcon = document.createElement('span');
            editIcon.className = 'edit-icon';
            // Replace pencil emoji with blue edit icon SVG
            editIcon.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" fill="#2563eb" viewBox="0 0 24 24" stroke="#2563eb" stroke-width="1.5" width="18" height="18" style="vertical-align: middle;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2v-5m-10-7l7 7m0 0l3-3m-3 3v-3" />
              </svg>
            `;
            editIcon.style.marginLeft = 'auto';
            editIcon.style.padding = '0 8px';
            editIcon.style.cursor = 'pointer';
            editIcon.style.fontSize = '16px';
            editIcon.addEventListener('click', function(e) {
              e.stopPropagation();
              openServiceModal(btn);
            });
            btn.appendChild(editIcon);

            // Add delete icon next to edit icon
            if (!btn.querySelector('.delete-icon')) {
              const deleteIcon = document.createElement('span');
              deleteIcon.className = 'delete-icon';
              deleteIcon.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="#ef4444" viewBox="0 0 24 24" stroke="#ef4444" stroke-width="1.5" width="18" height="18" style="vertical-align: middle; cursor: pointer;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
              `;
              deleteIcon.style.padding = '0 8px';
              deleteIcon.title = 'Hapus layanan';
              deleteIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                if (confirm('Yakin ingin menghapus layanan ini?')) {
                  btn.remove();
                  saveContent();
                }
              });
              btn.appendChild(deleteIcon);
            }
          }
        });

        // Enable URL editing on double click
        enableURLEditing(linksContainer);

        // Enable logo editing on double click for menu logos
        enableLogoEditing(linksContainer);

        // Show border for container and avatar
        container.style.border = '2px dashed #34d399';
        avatarImg.style.outline = '2px dashed #34d399';
        avatarImg.style.cursor = 'pointer';

        // Add click handler to avatar image to change logo
        avatarImg.addEventListener('click', onChangeLogoClick);

      } else {
        showToast('Editing mode disabled');

        // Remove contenteditable attributes
        mainTitle.removeAttribute('contenteditable');
        desc.removeAttribute('contenteditable');

        linksContainer.querySelectorAll('button.link-btn').forEach(btn => {
          btn.removeAttribute('contenteditable');
          btn.style.outline = 'none';
          
          // Remove edit icons
          const editIcon = btn.querySelector('.edit-icon');
          if (editIcon) {
            editIcon.remove();
          }
        });

        // Remove drag and drop handlers
        disableDragAndDropLinks(linksContainer);

        // Remove logo editing handlers
        disableLogoEditing(linksContainer);

        // Remove avatar image outline and cursor
        avatarImg.style.outline = 'none';
        avatarImg.style.cursor = 'default';

        // Remove click handler from avatar image
        avatarImg.removeEventListener('click', onChangeLogoClick);

        container.style.border = 'none';

        saveContent();
      }
    }

    // Enhanced drag and drop for links container buttons with better mobile support
    function enableDragAndDropLinks(container) {
      let dragSrcEl = null;
      let touchStartY = 0;
      let touchStartX = 0;
      let isDragging = false;
      let dragOffsetY = 0;
      let dragOffsetX = 0;
      let ghostElement = null;

      function handleDragStart(e) {
        dragSrcEl = this;
        if (e.dataTransfer) {
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', this.outerHTML);
        }
        this.classList.add('dragElem');
        isDragging = true;
        
        // Create visual feedback for desktop
        this.style.opacity = '0.7';
      }

      function handleTouchStart(e) {
        const touch = e.touches[0];
        touchStartY = touch.clientY;
        touchStartX = touch.clientX;
        
        // Get the position of the element relative to viewport
        const rect = this.getBoundingClientRect();
        dragOffsetY = touch.clientY - rect.top;
        dragOffsetX = touch.clientX - rect.left;
        
        handleDragStart.call(this, e);
        e.preventDefault();
        
        // Create ghost element for mobile dragging
        createGhostElement(this, touch.clientX, touch.clientY);
      }

      function handleDragOver(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        if (e.dataTransfer) {
          e.dataTransfer.dropEffect = 'move';
        }
        return false;
      }

      function handleTouchMove(e) {
        if (!isDragging) return;
        
        const touch = e.touches[0];
        const touchY = touch.clientY;
        const touchX = touch.clientX;
        
        // Update ghost element position
        if (ghostElement) {
          ghostElement.style.top = (touchY - dragOffsetY) + 'px';
          ghostElement.style.left = (touchX - dragOffsetX) + 'px';
        }
        
        // Calculate movement for scroll prevention
        const deltaY = Math.abs(touchY - touchStartY);
        const deltaX = Math.abs(touchX - touchStartX);
        
        // Prevent scrolling if user is intentionally dragging
        if (deltaY > 5 || deltaX > 5) {
          e.preventDefault();
        }
        
        // Find drop target
        const dropTarget = findDropTarget(touchX, touchY);
        if (dropTarget && dropTarget !== dragSrcEl) {
          dropTarget.classList.add('over');
        }
        
        // Remove 'over' class from other elements
        container.querySelectorAll('button.link-btn.over').forEach(item => {
          if (item !== dropTarget) {
            item.classList.remove('over');
          }
        });
      }

      function handleDragEnter() {
        this.classList.add('over');
      }

      function handleDragLeave() {
        this.classList.remove('over');
      }

      function handleDrop(e) {
        if (e.stopPropagation) {
          e.stopPropagation();
        }
        
        let dropTarget = this;
        if (!isDragging) return false;
        
        if (dragSrcEl !== dropTarget) {
          // Swap positions instead of inserting before/after
          const parent = dropTarget.parentNode;
          const dragSrcNextSibling = dragSrcEl.nextSibling;
          const dropTargetNextSibling = dropTarget.nextSibling;
          
          // Insert dropTarget where dragSrcEl was
          if (dragSrcNextSibling) {
            parent.insertBefore(dropTarget, dragSrcNextSibling);
          } else {
            parent.appendChild(dropTarget);
          }
          
          // Insert dragSrcEl where dropTarget was
          if (dropTargetNextSibling) {
            parent.insertBefore(dragSrcEl, dropTargetNextSibling);
          } else {
            parent.appendChild(dragSrcEl);
          }
        }
        
        cleanupAfterDrop();
        return false;
      }

      function handleTouchEnd(e) {
        if (!isDragging) return;
        
        const touch = e.changedTouches[0];
        const dropTarget = findDropTarget(touch.clientX, touch.clientY);
        
        if (dropTarget && dropTarget !== dragSrcEl) {
          // Swap positions instead of inserting before/after
          const parent = dropTarget.parentNode;
          const dragSrcNextSibling = dragSrcEl.nextSibling;
          const dropTargetNextSibling = dropTarget.nextSibling;
          
          // Insert dropTarget where dragSrcEl was
          if (dragSrcNextSibling) {
            parent.insertBefore(dropTarget, dragSrcNextSibling);
          } else {
            parent.appendChild(dropTarget);
          }
          
          // Insert dragSrcEl where dropTarget was
          if (dropTargetNextSibling) {
            parent.insertBefore(dragSrcEl, dropTargetNextSibling);
          } else {
            parent.appendChild(dragSrcEl);
          }
        }
        
        cleanupAfterDrop();
      }

      function handleDragEnd() {
        cleanupAfterDrop();
      }

      function createGhostElement(element, x, y) {
        // Remove existing ghost element if any
        if (ghostElement) {
          document.body.removeChild(ghostElement);
        }
        
        ghostElement = element.cloneNode(true);
        ghostElement.style.position = 'fixed';
        ghostElement.style.zIndex = '1000';
        ghostElement.style.opacity = '0.8';
        ghostElement.style.pointerEvents = 'none';
        ghostElement.style.transform = 'scale(1.05)';
        ghostElement.style.boxShadow = '0 8px 25px rgba(0,0,0,0.3)';
        ghostElement.style.top = (y - dragOffsetY) + 'px';
        ghostElement.style.left = (x - dragOffsetX) + 'px';
        ghostElement.style.width = element.offsetWidth + 'px';
        
        document.body.appendChild(ghostElement);
      }

      function findDropTarget(x, y) {
        // Get all potential drop targets
        const targets = container.querySelectorAll('button.link-btn');
        let closestTarget = null;
        let closestDistance = Infinity;
        
        // Find the closest target to the touch point
        targets.forEach(target => {
          if (target === dragSrcEl) return;
          
          const rect = target.getBoundingClientRect();
          const centerY = rect.top + rect.height / 2;
          const centerX = rect.left + rect.width / 2;
          
          // Calculate distance to center of target
          const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
          
          if (distance < closestDistance) {
            closestDistance = distance;
            closestTarget = target;
          }
        });
        
        return closestTarget;
      }

      function cleanupAfterDrop() {
        // Remove ghost element
        if (ghostElement) {
          document.body.removeChild(ghostElement);
          ghostElement = null;
        }
        
        // Reset drag source element
        if (dragSrcEl) {
          dragSrcEl.classList.remove('dragElem');
          dragSrcEl.style.opacity = '1';
        }
        
        // Remove 'over' class from all elements
        container.querySelectorAll('button.link-btn.over').forEach(item => {
          item.classList.remove('over');
        });
        
        dragSrcEl = null;
        isDragging = false;
      }

      function addDnDHandlersLinks(elem) {
        elem.setAttribute('draggable', 'true');
        
        // Add drag handle for mobile (small icon on the right)
          if (!elem.querySelector('.drag-handle')) {
            const dragHandle = document.createElement('span');
            dragHandle.className = 'drag-handle';
            dragHandle.style.marginLeft = 'auto';
            dragHandle.style.padding = '0 8px';
            dragHandle.style.cursor = 'move';
            dragHandle.style.opacity = '0.7';
            dragHandle.style.fontSize = '16px';
            dragHandle.style.userSelect = 'none';
            // Replace drag handle text with plus icon SVG
            dragHandle.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="18" height="18" style="color: #34d399;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
            `;
            elem.appendChild(dragHandle);
          }
        
        // Desktop events
        elem.addEventListener('dragstart', handleDragStart, false);
        elem.addEventListener('dragenter', handleDragEnter, false);
        elem.addEventListener('dragover', handleDragOver, false);
        elem.addEventListener('dragleave', handleDragLeave, false);
        elem.addEventListener('drop', handleDrop, false);
        elem.addEventListener('dragend', handleDragEnd, false);
        
        // Mobile touch events - attach to the entire element for better mobile support
        elem.addEventListener('touchstart', handleTouchStart, {passive: false});
        elem.addEventListener('touchmove', handleTouchMove, {passive: false});
        elem.addEventListener('touchend', handleTouchEnd, false);
        elem.addEventListener('touchcancel', handleDragEnd, false);
      }

      function removeDnDHandlersLinks(elem) {
        elem.removeAttribute('draggable');

        // Remove drag handle if exists
        const dragHandle = elem.querySelector('.drag-handle');
        if (dragHandle) {
          dragHandle.remove();
        }

        // Remove desktop events
        elem.removeEventListener('dragstart', handleDragStart, false);
        elem.removeEventListener('dragenter', handleDragEnter, false);
        elem.removeEventListener('dragover', handleDragOver, false);
        elem.removeEventListener('dragleave', handleDragLeave, false);
        elem.removeEventListener('drop', handleDrop, false);
        elem.removeEventListener('dragend', handleDragEnd, false);
        
        // Remove mobile touch events from the entire element
        elem.removeEventListener('touchstart', handleTouchStart, {passive: false});
        elem.removeEventListener('touchmove', handleTouchMove, {passive: false});
        elem.removeEventListener('touchend', handleTouchEnd, false);
        elem.removeEventListener('touchcancel', handleDragEnd, false);
      }

      // Add CSS for better mobile drag experience
      const style = document.createElement('style');
      style.textContent = `
        .dragElem {
          transform: scale(1.02) !important;
          box-shadow: 0 8px 25px rgba(52, 211, 153, 0.4) !important;
          z-index: 100 !important;
        }
        
        .over {
          border: 2px dashed #34d399 !important;
          background-color: #d1fae5 !important;
        }
        
        .drag-handle:hover {
          opacity: 1 !important;
        }
        
        @media (max-width: 480px) {
          .drag-handle {
            font-size: 18px !important;
            padding: 0 10px !important;
          }
          
          button.link-btn.dragElem {
            transform: scale(1.05) !important;
          }
        }
      `;
      document.head.appendChild(style);

      const items = container.querySelectorAll('button.link-btn');
      items.forEach(addDnDHandlersLinks);
    }

    function disableDragAndDropLinks(container) {
      const items = container.querySelectorAll('button.link-btn');
      items.forEach(function (item) {
        removeDnDHandlersLinks(item);
      });
    }

    // Change logo image handler
    function onChangeLogoClick() {
      const url = prompt('Masukkan URL gambar logo baru:');
      if (url) {
        const avatarImg = document.querySelector('.avatar img');
        avatarImg.src = url;
        saveContent();
      }
    }

    // Logo editing functionality for menu logos
    function enableLogoEditing(linksContainer) {
      linksContainer.querySelectorAll('button.link-btn img').forEach(img => {
        img.style.cursor = 'pointer';
        img.style.outline = '2px dashed #34d399';
        img.addEventListener('dblclick', function(e) {
          e.stopPropagation();
          const url = prompt('Masukkan URL gambar logo baru:');
          if (url) {
            img.src = url;
            saveContent();
          }
        });
      });
    }

    function disableLogoEditing(linksContainer) {
      linksContainer.querySelectorAll('button.link-btn img').forEach(img => {
        img.style.cursor = 'default';
        img.style.outline = 'none';
        img.removeEventListener('dblclick', arguments.callee);
      });
    }

    // URL editing functionality
    function enableURLEditing(linksContainer) {
      linksContainer.querySelectorAll('button.link-btn').forEach(btn => {
        btn.addEventListener('dblclick', function(e) {
          e.stopPropagation();
          const currentUrl = this.getAttribute('onclick').match(/'(.*?)'/)[1];
          const newUrl = prompt('Masukkan URL baru:', currentUrl);
          if (newUrl) {
            this.setAttribute('onclick', `openLink('${newUrl}')`);
            saveContent();
          }
        });
      });
    }

    function openServiceModal(button) {
      const modal = document.getElementById('serviceModal');
      const form = document.getElementById('serviceForm');
      const titleInput = document.getElementById('serviceTitle');
      const urlInput = document.getElementById('serviceUrl');
      const logoInput = document.getElementById('serviceLogo');
      const logoPreview = document.getElementById('logoPreview');
      const modalTitle = document.getElementById('serviceModalTitle');
      
      // Get current service data from the button
      const serviceName = button.textContent.trim();
      const serviceUrl = button.getAttribute('onclick').match(/'(.*?)'/)[1];
      const serviceLogo = button.querySelector('img').src;
      
      // Fill the form with current data
      titleInput.value = serviceName;
      urlInput.value = serviceUrl;
      logoInput.value = serviceLogo;
      logoPreview.src = serviceLogo;
      
      // Update modal title
      modalTitle.textContent = 'Edit Layanan';
      
      // Store reference to the button being edited
      form.dataset.editingButton = Array.from(document.querySelectorAll('.link-btn')).indexOf(button);
      
      // Show the modal
      modal.classList.remove('hidden');
    }

    function saveContent() {
      // Save content to localStorage or send to server
      showToast('Perubahan disimpan');
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function openLink(url) {
      window.open(url, '_blank');
    }

    function openWhatsApp() {
      const phoneNumber = '+6281227272727';
      const message = 'Halo TeluGe Agro, saya tertarik dengan produk pisang Anda!';
      const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }

    // Service Modal functionality
    const serviceModal = document.getElementById('serviceModal');
    const serviceForm = document.getElementById('serviceForm');
    const cancelServiceBtn = document.getElementById('cancelServiceBtn');
    const closeServiceModal = document.getElementById('closeServiceModal');
    const logoInput = document.getElementById('serviceLogo');
    const logoPreview = document.getElementById('logoPreview');
    const addServiceBtnOutside = document.getElementById('addServiceBtnOutside');

    // Add event listener to the circular plus button
    addServiceBtnOutside.addEventListener('click', function() {
      if (isLoggedIn()) {
        openServiceModalForNew();
      } else {
        showLoginModal();
      }
    });

    // Logo preview functionality
    logoInput.addEventListener('input', function() {
      logoPreview.src = this.value;
    });

    // Close modal handlers
    cancelServiceBtn.addEventListener('click', hideServiceModal);
    closeServiceModal.addEventListener('click', hideServiceModal);

    // Close modal when clicking outside
    serviceModal.addEventListener('click', function(e) {
      if (e.target === serviceModal) {
        hideServiceModal();
      }
    });

    // Form submission handler
    serviceForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const title = document.getElementById('serviceTitle').value.trim();
      const url = document.getElementById('serviceUrl').value.trim();
      const logo = document.getElementById('serviceLogo').value.trim();
      
      if (!title || !url) {
        showToast('Judul dan URL harus diisi');
        return;
      }

      const buttonIndex = parseInt(serviceForm.dataset.editingButton);
      const buttons = document.querySelectorAll('.link-btn');
      
      if (buttonIndex >= 0 && buttonIndex < buttons.length) {
        // Update existing button
        const button = buttons[buttonIndex];
        button.setAttribute('onclick', `openLink('${url}')`);
        button.setAttribute('aria-label', 'Buka ' + title);
        
        // Update button text
        const textNode = Array.from(button.childNodes).find(node => node.nodeType === 3);
        if (textNode) {
          textNode.textContent = title;
        }
        
        // Update logo
        const img = button.querySelector('img');
        if (img) {
          img.alt = 'Logo ' + title;
          if (logo) {
            img.src = logo;
          }
        }
        
        showToast('Layanan berhasil diperbarui');
      } else {
        // Add new service button
        const linksContainer = document.querySelector('.links');
        const newButton = document.createElement('button');
        newButton.className = 'link-btn';
        newButton.setAttribute('onclick', `openLink('${url}')`);
        newButton.setAttribute('aria-label', 'Buka ' + title);
        
        // Create logo image
        const logoImg = document.createElement('img');
        logoImg.alt = 'Logo ' + title;
        logoImg.onerror = function() {
          this.onerror = null;
          this.src = 'https://placehold.co/28x28/png?text=Error';
        };
        
        if (logo) {
          logoImg.src = logo;
        } else {
          // Default placeholder logo
          logoImg.src = 'https://placehold.co/28x28/22c55e/white?text=' + title.charAt(0).toUpperCase();
        }
        
        // Create service name text
        const serviceText = document.createTextNode(title);
        
        // Append elements to button
        newButton.appendChild(logoImg);
        newButton.appendChild(serviceText);
        
        // Add to links container
        linksContainer.appendChild(newButton);
        
        showToast('Layanan ' + title + ' berhasil ditambahkan!');
      }
      
      hideServiceModal();
      saveContent();
    });

    function openServiceModalForNew() {
      const modal = document.getElementById('serviceModal');
      const form = document.getElementById('serviceForm');
      const titleInput = document.getElementById('serviceTitle');
      const urlInput = document.getElementById('serviceUrl');
      const logoInput = document.getElementById('serviceLogo');
      const logoPreview = document.getElementById('logoPreview');
      const modalTitle = document.getElementById('serviceModalTitle');
      
      // Clear the form for new service
      form.reset();
      logoPreview.src = '';
      
      // Update modal title
      modalTitle.textContent = 'Tambah Layanan Baru';
      
      // Remove editing reference
      delete form.dataset.editingButton;
      
      // Show the modal
      modal.classList.remove('hidden');
    }

    function hideServiceModal() {
      serviceModal.classList.add('hidden');
      serviceForm.reset();
      logoPreview.src = '';
      delete serviceForm.dataset.editingButton;
    }

    // Share functionality
    document.getElementById('shareBtn').addEventListener('click', () => {
      if (navigator.share) {
        navigator.share({
          title: 'TeluGe Agro - Banana Supplier',
          text: 'Supplier Pisang Dan Spesialis - Good Bananas Supplier & Specialist Until Export',
          url: window.location.href
        }).catch(console.error);
      } else {
        navigator.clipboard.writeText(window.location.href).then(() => {
          showToast('Link disalin ke clipboard!');
        }).catch(console.error);
      }
    });

    // Create admin menu if it doesn't exist
    function createAdminMenu() {
      adminMenu = document.getElementById('adminMenu');
      if (!adminMenu) {
        adminMenu = document.createElement('div');
        adminMenu.id = 'adminMenu';
        adminMenu.className = 'hidden absolute bg-white rounded-lg shadow-lg border border-gray-200 z-50';
        adminMenu.style.minWidth = '200px';
        
        const header = document.createElement('div');
        header.className = 'p-3 border-b border-gray-100';
        header.innerHTML = `
          <p class="text-sm font-semibold text-gray-800">${ADMIN_USERNAME}</p>
          <p class="text-xs text-gray-400">Admin Panel</p>
        `;
        
        const manageBtn = document.createElement('button');
        manageBtn.className = 'flex items-center gap-2 px-3 py-2 text-gray-700 hover:bg-green-50 hover:text-green-600 transition w-full text-left';
        manageBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3a.75.75 0 01.75.75V6a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75V3.75A.75.75 0 016 3h3.75zM18 3.75A.75.75 0 0017.25 3H13.5a.75.75 0 00-.75.75V6a.75.75 0 00.75.75h3.75A.75.75 0 0018 6V3.75zM9.75 13.5a.75.75 0 01.75.75V18a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75v-3.75A.75.75 0 016 13.5h3.75zM18 13.5a.75.75 0 00-.75.75V18a.75.75 0 00.75.75h3.75a.75.75 0 00.75-.75v-3.75a.75.75 0 00-.75-.75H18z"/>
          </svg>
          Manage Web
        `;
        manageBtn.onclick = manageWeb;
        
        const logoutBtn = document.createElement('button');
        logoutBtn.className = 'flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 transition w-full text-left';
        logoutBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-9A2.25 2.25 0 002.25 5.25v13.5A2.25 2.25 0 004.5 21h9a2.25 2.25 0 002.25-2.25V15M12 9l3-3m0 0l3 3m-3-3v12"/>
          </svg>
          Logout
        `;
        logoutBtn.onclick = logoutAdmin;
        
        adminMenu.appendChild(header);
        adminMenu.appendChild(manageBtn);
        adminMenu.appendChild(logoutBtn);
        document.body.appendChild(adminMenu);
      }
    }
  </script>
</body>
</html>
