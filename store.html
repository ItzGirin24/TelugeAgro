<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teluge Agro - Online Store</title>
     <link rel="icon" href="logo Teluge.jpg" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');
        body {
            background: linear-gradient(to bottom, #E8F5E9 0%, #FFFFFF 100%);
            font-family: 'Quicksand', sans-serif;
        }
        .hero-bg {
            background: linear-gradient(135deg, #4CAF50, #81C784);
        }
        .text-shadow-green {
            text-shadow: 0 2px 4px rgba(76, 175, 80, 0.5);
        }
        .fade-in {
            opacity: 0;
            animation: fadeIn 1s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        .product-card:hover {
            transform: scale(1.05);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
        }
    </style>
</head>
<body class="text-gray-800">
    <header class="bg-green-700 text-white py-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center px-4 relative">
            <div class="flex items-center space-x-2">
                <img src="logo Teluge.jpg" alt="Green leaf icon symbolizing nature and agriculture, stylized as a fresh plant leaf in vibrant green hues" class="w-8 h-8 rounded-full placeholder-img">
                <h1 class="text-2xl font-bold text-shadow-green">Teluge Agro</h1>
            </div>
            <button id="hamburger-btn" aria-label="Toggle menu" class="md:hidden focus:outline-none z-30">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>
            <nav id="nav-menu" class="hidden md:flex space-x-6 text-white font-semibold">
                <a href="leadingpage.html" class="hover:text-green-300">About</a>
                <a href="#products" class="hover:text-green-300">Products</a>
         
                <a href="store.html" class="text-green-300 font-bold border-b-2 border-white">Store</a>
                <a href="cart.html" id="cart-link" class="hover:text-green-300 relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
                    </svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </nav>
            <!-- Mobile menu -->
            <nav id="mobile-menu" class="hidden bg-green-600 text-white px-4 py-2 md:hidden flex flex-col space-y-2 absolute top-full right-4 rounded shadow-lg z-20 w-40">
                <a href="leadingpage.html" class="hover:text-green-300">About</a>
                <a href="#products" class="hover:text-green-300">Products</a>
         
                <a href="store.html" class="text-white font-bold bg-green-700 rounded-full px-3 py-1 flex items-center space-x-2 border border-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
                    </svg>
                    <span>Cart</span>
                    <span id="cart-count-mobile" class="bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg text-white py-16 relative">
        <div class="container mx-auto text-center px-4">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ae582dc6-99f8-473f-b414-7b01b27b6708.png" alt="Variety of fresh bananas including green and yellow bunches arranged on a wooden display in a tropical market stall setting" class="mx-auto mb-6 rounded-lg shadow-lg">
            <h2 class="text-4xl md:text-5xl font-extrabold mb-4 text-shadow-green">Pisang Segar & Kualitas Ekspor</h2>
            <p class="text-lg md:text-xl mb-8">Belanja Langsung dari Purworejo, Indonesia - Berkelanjutan & Premium</p>
            <a href="#products" class="bg-white text-green-700 px-6 py-3 rounded-full font-bold hover:bg-gray-100 transition">Jelajahi Produk</a>
        </div>
        <div class="absolute bottom-0 left-0 right-0 h-16 bg-white" style="clip-path: polygon(0% 100%, 100% 0%, 100% 100%);"></div>
    </section>

    <!-- Products Section -->
    <section id="products" class="py-16 bg-green-50">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-semibold text-center text-green-800 mb-10">Produk Kami</h3>

            <!-- Add New Product Button (Admin Only) -->
            <div id="addProductSection" class="text-center mb-8 hidden">
                <button onclick="showAddProductForm()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-300 flex items-center gap-2 mx-auto">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Tambah Produk Baru
                </button>


    <!-- Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close cursor-pointer text-2xl font-bold text-red-500">&times;</span>
            <h3 class="text-2xl font-bold text-green-800 mb-4">Your Cart</h3>
            <div id="cart-items" class="mb-4">
                <!-- Cart items will be populated here -->
            </div>
            <p class="text-lg font-semibold">Total: Rp<span id="cart-total">0.000</span></p>
            <button id="checkout-btn" class="bg-green-600 text-white px-6 py-2 mt-4 rounded hover:bg-green-700">Checkout</button>
        </div>
    </div>

    <!-- Footer -->
  <footer class="bg-gray-800 text-white py-4 text-center">
    <p>Â© 2023 Teluge Agro. All rights reserved.</p>
  </footer>

  <!-- Cart Popup -->
  <div id="cart-popup" class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-full shadow-lg cursor-pointer hidden z-50">
    <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
    </svg>
    <span id="popup-count">0</span> items in cart
  </div>

  <!-- Admin Account Button -->
  <button id="accountBtn" aria-label="Account Menu" title="Account Menu" class="fixed bottom-4 left-4 bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700 transition z-50 flex items-center justify-center">
    <svg fill="none" viewBox="0 0 24 24" aria-hidden="true" class="w-6 h-6">
      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
      <path d="M5 21c0-3 6-3 7-3s7 0 7 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- Admin Panel Popup -->
  <div id="adminMenu" class="hidden fixed bottom-16 left-4 bg-white rounded-lg shadow-xl border border-gray-200 z-40 w-64">
    <div class="p-4 border-b border-gray-100">
      <p class="text-sm font-semibold text-gray-800">TelugeAgro_Admin</p>
      <p class="text-xs text-gray-400">Admin Panel</p>
    </div>
    <div class="flex flex-col">
      <button onclick="manageProducts()"
        class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3a.75.75 0 01.75.75V6a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75V3.75A.75.75 0 016 3h3.75zM18 3.75A.75.75 0 0017.25 3H13.5a.75.75 0 00-.75.75V6a.75.75 0 00.75.75h3.75A.75.75 0 0018 6V3.75zM9.75 13.5a.75.75 0 01.75.75V18a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75v-3.75A.75.75 0 016 13.5h3.75zM18 13.5a.75.75 0 00-.75.75V18a.75.75 0 00.75.75h3.75a.75.75 0 00.75-.75v-3.75a.75.75 0 00-.75-.75H18z"/>
        </svg>
        Manage Products
      </button>
      <button onclick="logoutAdmin()"
        class="flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-9A2.25 2.25 0 002.25 5.25v13.5A2.25 2.25 0 004.5 21h9a2.25 2.25 0 002.25-2.25V15M12 9l3-3m0 0l3 3m-3-3v12"/>
        </svg>
        Logout
      </button>
      <button onclick="manageOrders()"
        class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h4l3 8 4-16 3 8h4" />
        </svg>
        Pesanan
      </button>
      <button onclick="manageWeb()"
        class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Manage Web
      </button>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" role="dialog" aria-modal="true" aria-labelledby="loginTitle" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg p-6 w-80 max-w-full shadow-lg">
      <h2 id="loginTitle" class="text-xl font-bold mb-4 text-center text-green-700">Admin Login</h2>
      <form id="loginForm" class="flex flex-col gap-4">
        <label for="username" class="font-semibold text-green-600">Username</label>
        <input type="text" id="username" name="username" required class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        <label for="password" class="font-semibold text-green-600">Password</label>
        <input type="password" id="password" name="password" required class="border border-green-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" />
        <button type="submit" class="bg-green-600 text-white rounded py-2 font-semibold hover:bg-green-700 transition">Login</button>
        <button type="button" id="loginCancel" class="mt-2 text-center text-green-600 hover:underline">Cancel</button>
      </form>
      <p id="loginError" class="text-red-600 mt-2 hidden" role="alert"></p>
    </div>
  </div>

  <!-- Product Edit Modal -->
  <div id="productModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-60">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96 max-w-full">
      <h2 id="productModalTitle" class="text-lg font-bold mb-4 text-green-700">Edit Product</h2>
      <form id="productForm">
        <div class="mb-4">
          <label for="productTitle" class="block text-sm font-medium text-gray-700">Title</label>
          <input type="text" id="productTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
        </div>
        <div class="mb-4">
          <label for="productDescription" class="block text-sm font-medium text-gray-700">Description</label>
          <textarea id="productDescription" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" rows="3" required></textarea>
        </div>
        <div class="mb-4">
          <label for="productPrice" class="block text-sm font-medium text-gray-700">Price (Rp)</label>
          <input type="number" id="productPrice" step="0.001" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
        </div>
        <div class="mb-4">
          <label for="productImage" class="block text-sm font-medium text-gray-700">Image URL</label>
          <input type="url" id="productImage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
        </div>
        <div class="flex justify-end gap-3">
          <button type="button" id="cancelProductBtn" class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 hidden">
    <span id="toastMessage"></span>
  </div>

  <!-- Web Management Modal -->
  <div id="webModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-60">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96 max-w-full">
      <h2 id="webModalTitle" class="text-lg font-bold mb-4 text-green-700">Manage Web Content</h2>
      <form id="webForm">
        <div class="mb-4">
          <label for="pageTitle" class="block text-sm font-medium text-gray-700">Page Title</label>
          <input type="text" id="pageTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
        </div>
        <div class="mb-4">
          <label for="heroTitle" class="block text-sm font-medium text-gray-700">Hero Title</label>
          <input type="text" id="heroTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
        </div>
        <div class="mb-4">
          <label for="heroDescription" class="block text-sm font-medium text-gray-700">Hero Description</label>
          <textarea id="heroDescription" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" rows="3" required></textarea>
        </div>
        <div class="mb-4">
          <label for="heroImage" class="block text-sm font-medium text-gray-700">Hero Image URL</label>
          <input type="url" id="heroImage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
        </div>
        <div class="flex justify-end gap-3">
          <button type="button" id="cancelWebBtn" class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB2sLqWwZIxr65c3CcNgKCCjmDTeDlSnfY",
            authDomain: "telugeagro2025.firebaseapp.com",
            projectId: "telugeagro2025",
            storageBucket: "telugeagro2025.firebasestorage.app",
            messagingSenderId: "1029963109637",
            appId: "1:1029963109637:web:86824d0db45e1489b3136c",
            measurementId: "G-XF1JDPME66"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let cartItems = {}; // Will store cart as object with product names as keys
        let isAdmin = false;
        let isEditMode = false;
        let products = [];
        let currentEditingProduct = null;

        // Admin credentials (in production, use proper authentication)
        const ADMIN_CREDENTIALS = {
            username: 'teluge@admin.app',
            password: 'teluge2025'
        };

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.className = `fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white`;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Load products from Firebase
        async function loadProducts() {
            try {
                const querySnapshot = await db.collection('products').orderBy('order', 'asc').get();
                products = [];
                querySnapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                // Save to localStorage as backup
                localStorage.setItem('products', JSON.stringify(products));
                renderProducts();
            } catch (error) {
                console.error('Error loading products from Firebase:', error);
                // Fallback to localStorage or static products
                loadProductsFromStorage();
            }
        }

        // Load products from localStorage or static fallback
        function loadProductsFromStorage() {
            const storedProducts = localStorage.getItem('products');
            if (storedProducts) {
                try {
                    products = JSON.parse(storedProducts);
                    renderProducts();
                    showToast('Loaded products from local storage', 'success');
                } catch (error) {
                    console.error('Error parsing stored products:', error);
                    loadStaticProducts();
                }
            } else {
                loadStaticProducts();
            }
        }

        // Load static products as fallback
        function loadStaticProducts() {
            products = [
                {
                    id: 'cavendish',
                    title: 'Pisang Cavendish',
                    description: 'Manis dan creamy, cocok untuk ekspor. Harga: Rp.12.000 per kg',
                    price: 2.50,
                    image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/6687a905-5ec4-43e4-9738-c2cc0c9db9b7.png',
                    order: 1
                },
                {
                    id: 'green-bananas',
                    title: 'Pisang Hijau',
                    description: 'Fresh and healthy options for local markets. Price: Rp.14.000 per kg',
                    price: 1.80,
                    image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ae569231-d922-40c1-b7b2-db4e98abb5e1.png',
                    order: 2
                },
                {
                    id: 'bulk-export',
                    title: 'Ekspor Paket Massal',
                    description: 'Kemasan grosir untuk distributor. Harga: Rp.17.000 per kg (min. 100 kg)',
                    price: 190.00,
                    image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0472f936-2084-4f51-9c4d-414ee6926919.png',
                    order: 3
                },
                {
                    id: 'plantain',
                    title: 'Pisang Untuk Kue',
                    description: 'Cocok untuk memasak dan menggoreng. Harga: Rp. 15.000 per kg',
                    price: 1.50,
                    image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/bd310699-54f4-480f-a0a5-4f8c3610f6d0.png',
                    order: 4
                },
                {
                    id: 'silk-bananas',
                    title: 'Pisang Sutra',
                    description: 'Pisang manis mini untuk camilan. Harga: Rp. 25.0000 per kg',
                    price: 3.00,
                    image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/fd4dc657-9fda-44f4-b8a1-358a90c514e9.png',
                    order: 5
                },
                {
                    id: 'snacks-pack',
                    title: 'Paket Cemilan Pisang',
                    description: 'Keripik pisang kering dan produk lainnya. Harga: Rp. 20.000 per bungkus',
                    price: 5.00,
                    image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/a9d1dfe3-39bd-4e8b-b78b-dcae997768e0.png',
                    order: 6
                }
            ];
            renderProducts();
        }

        // Render products
        function renderProducts() {
            const productsGrid = document.querySelector('#products .grid');
            productsGrid.innerHTML = '';

            products.forEach((product, index) => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white p-6 rounded-lg shadow-lg product-card transition duration-300 fade-in';
                productCard.style.animationDelay = `${index * 0.1}s`;
                productCard.draggable = isAdmin && isEditMode;
                productCard.dataset.productId = product.id;

                if (isAdmin && isEditMode) {
                    productCard.classList.add('cursor-move');
                    productCard.addEventListener('dragstart', handleDragStart);
                    productCard.addEventListener('dragover', handleDragOver);
                    productCard.addEventListener('drop', handleDrop);
                    productCard.addEventListener('dragend', handleDragEnd);
                }

                productCard.innerHTML = `
                    ${isAdmin && isEditMode ? '<div class="drag-handle cursor-move text-gray-400 mb-2 text-center">â®â®</div>' : ''}
                    <img src="${product.image}" alt="${product.title}" class="mx-auto mb-4 rounded">
                    <h4 class="text-xl font-bold text-green-700 mb-2">${product.title}</h4>

                    <p class="text-gray-600 mb-4">${product.description}</p>

                    <p class="text-lg font-semibold text-green-600 mb-4">Rp${product.price.toFixed(3)}</p>
                    <button class="add-to-cart bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" data-product="${product.title}" data-price="${product.price}">Add to Cart</button>
                    ${isAdmin && isEditMode ? `
                        <div class="mt-2 flex gap-2">
                            <button onclick="editProduct('${product.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">Edit</button>
                            <button onclick="deleteProduct('${product.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                        </div>
                    ` : ''}
                `;

                productsGrid.appendChild(productCard);
            });

            // Re-attach cart event listeners
            attachCartListeners();
        }

        // Load cart from localStorage
        function loadCart() {
            const cartData = localStorage.getItem('cart');
            console.log('Loading cart from localStorage:', cartData);
            cartItems = JSON.parse(cartData) || {};
            console.log('Loaded cart items:', cartItems);
            updateCartUI();
        }

        // Save cart to localStorage
        function saveCart() {
            console.log('Saving cart to localStorage:', cartItems);
            localStorage.setItem('cart', JSON.stringify(cartItems));
            console.log('localStorage after save:', localStorage.getItem('cart'));
        }

        // Add item to cart
        function addToCart(product, price) {
            console.log('Adding to cart:', product, 'Price:', price);
            if (cartItems[product]) {
                cartItems[product].quantity += 1;
            } else {
                cartItems[product] = { product, price: parseFloat(price), quantity: 1 };
            }
            console.log('Cart items after adding:', cartItems);
            saveCart();
            updateCartUI();
            showToast(`${product} added to cart!`);
        }

        // Remove item from cart
        function removeFromCart(productName) {
            delete cartItems[productName];
            saveCart();
            updateCartUI();
        }

        // Clear cart
        function clearCart() {
            cartItems = {};
            saveCart();
            updateCartUI();
        }

        // Attach cart event listeners
        function attachCartListeners() {
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const product = this.dataset.product;
                    const price = this.dataset.price;
                    addToCart(product, price);
                });
            });
        }

        function updateCartUI() {
            const cartItemsDiv = document.getElementById('cart-items');
            cartItemsDiv.innerHTML = '';
            let total = 0;
            const items = Object.values(cartItems);

            // Update cart count badge
            const cartCount = items.reduce((acc, item) => acc + item.quantity, 0);
            const cartCountElem = document.getElementById('cart-count');
            const cartCountMobileElem = document.getElementById('cart-count-mobile');
            if (cartCountElem) cartCountElem.textContent = cartCount;
            if (cartCountMobileElem) cartCountMobileElem.textContent = cartCount;

            // Update popup
            const popup = document.getElementById('cart-popup');
            const popupCount = document.getElementById('popup-count');
            if (cartCount > 0) {
                popup.classList.remove('hidden');
                popupCount.textContent = cartCount;
            } else {
                popup.classList.add('hidden');
            }

            items.forEach(item => {
                total += item.price * item.quantity;
                    cartItemsDiv.innerHTML += `
                        <div class="flex justify-between py-2">
                            <span>${item.product} (x${item.quantity})</span>
                            <span>Rp${(item.price * item.quantity).toFixed(3)}</span>
                            <button class="remove-btn text-red-500" data-product="${item.product}">Remove</button>
                        </div>
                    `;
            });
            document.getElementById('cart-total').textContent = total.toFixed(3);

            // Event delegation for remove buttons
            document.getElementById('cart-items').addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-btn')) {
                    const product = e.target.dataset.product;
                    removeFromCart(product);
                }
            });

            const checkoutBtn = document.getElementById('checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', () => {
                    const items = Object.values(cartItems);
                    if (items.length === 0) {
                        alert('Your cart is empty!');
                    } else {
                        // Redirect to cart.html on checkout
                        window.location.href = 'cart.html';
                    }
                });
            }
        }

        // Drag and drop functions
        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('opacity-50');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const afterElement = getDragAfterElement(e.target.closest('.product-card').parentElement, e.clientY);
            const draggable = document.querySelector('.dragging');
            if (afterElement == null) {
                e.target.closest('.product-card').parentElement.appendChild(draggable);
            } else {
                e.target.closest('.product-card').parentElement.insertBefore(draggable, afterElement);
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const afterElement = getDragAfterElement(e.target.closest('.product-card').parentElement, e.clientY);
            const draggable = document.querySelector('.dragging');
            if (afterElement == null) {
                e.target.closest('.product-card').parentElement.appendChild(draggable);
            } else {
                e.target.closest('.product-card').parentElement.insertBefore(draggable, afterElement);
            }
            updateProductOrder();
        }

        function handleDragEnd(e) {
            e.target.classList.remove('opacity-50', 'dragging');
            draggedElement = null;
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.product-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function updateProductOrder() {
            const productCards = document.querySelectorAll('.product-card');
            const newOrder = Array.from(productCards).map(card => card.dataset.productId);

            // Update the products array order
            products.sort((a, b) => {
                return newOrder.indexOf(a.id) - newOrder.indexOf(b.id);
            });

            // Update order property for each product
            products.forEach((product, index) => {
                product.order = index + 1;
            });

            showToast('Product order updated!');
        }

        // Admin functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginError').classList.add('hidden');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function loginAdmin(username, password) {
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdmin = true;
                localStorage.setItem('isAdmin', 'true');
                hideLoginModal();
                showAdminMenu();
                showToast('Admin login successful!');
                return true;
            } else {
                document.getElementById('loginError').textContent = 'Invalid credentials';
                document.getElementById('loginError').classList.remove('hidden');
                return false;
            }
        }

        function logoutAdmin() {
            isAdmin = false;
            isEditMode = false;
            localStorage.removeItem('isAdmin');
            hideAdminMenu();
            renderProducts();
            showToast('Logged out successfully');
        }

        function showAdminMenu() {
            document.getElementById('accountBtn').classList.remove('hidden');
        }

        function hideAdminMenu() {
            document.getElementById('accountBtn').classList.add('hidden');
            document.getElementById('adminMenu').classList.add('hidden');
        }

        function manageProducts() {
            isEditMode = !isEditMode;

            // Show/hide add product button
            const addProductSection = document.getElementById('addProductSection');
            if (isEditMode) {
                addProductSection.classList.remove('hidden');
            } else {
                addProductSection.classList.add('hidden');
            }

            renderProducts();
            showToast(isEditMode ? 'Edit mode enabled' : 'Edit mode disabled');
        }

        function manageOrders() {
            window.location.href = 'admin.html';
        }

        function manageWeb() {
            // Load current web content
            loadWebContent();
            // Show the web management modal
            document.getElementById('webModal').classList.remove('hidden');
        }

        // Load current web content into the form
        function loadWebContent() {
            // Get current values from the page
            const pageTitle = document.title;
            const heroTitle = document.querySelector('.hero-bg h2').textContent;
            const heroDescription = document.querySelector('.hero-bg p').textContent;
            const heroImage = document.querySelector('.hero-bg img').src;

            // Populate form fields
            document.getElementById('pageTitle').value = pageTitle;
            document.getElementById('heroTitle').value = heroTitle;
            document.getElementById('heroDescription').value = heroDescription;
            document.getElementById('heroImage').value = heroImage;
        }

        // Save web content changes
        function saveWebContent(pageTitle, heroTitle, heroDescription, heroImage) {
            try {
                // Update page title
                document.title = pageTitle;

                // Update hero section
                document.querySelector('.hero-bg h2').textContent = heroTitle;
                document.querySelector('.hero-bg p').textContent = heroDescription;
                document.querySelector('.hero-bg img').src = heroImage;

                // Save to localStorage for persistence
                const webContent = {
                    pageTitle,
                    heroTitle,
                    heroDescription,
                    heroImage
                };
                localStorage.setItem('webContent', JSON.stringify(webContent));

                showToast('Web content updated successfully!');
                return true;
            } catch (error) {
                console.error('Error updating web content:', error);
                showToast('Error updating web content. Please try again.', 'error');
                return false;
            }
        }

        function showAddProductForm() {
            // Clear the form for new product
            document.getElementById('productTitle').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productImage').value = '';

            // Set modal title
            document.getElementById('productModalTitle').textContent = 'Add New Product';

            // Reset current editing product
            currentEditingProduct = null;

            // Show modal
            document.getElementById('productModal').classList.remove('hidden');
        }

        function editProduct(productId) {
            currentEditingProduct = products.find(p => p.id === productId);
            if (currentEditingProduct) {
                document.getElementById('productTitle').value = currentEditingProduct.title;
                document.getElementById('productDescription').value = currentEditingProduct.description;
                document.getElementById('productPrice').value = currentEditingProduct.price;
                document.getElementById('productImage').value = currentEditingProduct.image;
                document.getElementById('productModalTitle').textContent = 'Edit Product';
                document.getElementById('productModal').classList.remove('hidden');
            }
        }

        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    // Try to delete from Firebase first
                    await db.collection('products').doc(productId).delete();
                    showToast('Product deleted successfully!');
                } catch (firebaseError) {
                    console.error('Firebase delete failed, deleting locally:', firebaseError);
                    showToast('Firebase unavailable, deleted locally', 'success');
                }
                // Remove from local array
                products = products.filter(p => p.id !== productId);
                // Save updated products to localStorage
                localStorage.setItem('products', JSON.stringify(products));
                renderProducts();
            }
        }

        // Event listeners
        document.getElementById('accountBtn').addEventListener('click', () => {
            if (isAdmin) {
                const adminMenu = document.getElementById('adminMenu');
                adminMenu.classList.toggle('hidden');
            } else {
                showLoginModal();
            }
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            loginAdmin(username, password);
        });

        document.getElementById('loginCancel').addEventListener('click', hideLoginModal);

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('productTitle').value;
            const description = document.getElementById('productDescription').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const image = document.getElementById('productImage').value;

            try {
                if (currentEditingProduct) {
                    // Try to update existing product in Firebase first
                    try {
                        await db.collection('products').doc(currentEditingProduct.id).update({
                            title,
                            description,
                            price,
                            image,
                            updatedAt: new Date()
                        });
                        showToast('Product updated successfully!');
                    } catch (firebaseError) {
                        console.error('Firebase update failed, using localStorage:', firebaseError);
                        showToast('Firebase unavailable, saved locally', 'success');
                    }

                    // Update local array
                    currentEditingProduct.title = title;
                    currentEditingProduct.description = description;
                    currentEditingProduct.price = price;
                    currentEditingProduct.image = image;

                } else {
                    // Try to add new product to Firebase first
                    let newProduct;
                    try {
                        const newProductData = {
                            title,
                            description,
                            price,
                            image,
                            order: products.length + 1,
                            createdAt: new Date()
                        };

                        const docRef = await db.collection('products').add(newProductData);

                        // Add to local array with Firebase-generated ID
                        newProduct = {
                            id: docRef.id,
                            ...newProductData
                        };
                        showToast('Product added successfully!');
                    } catch (firebaseError) {
                        console.error('Firebase add failed, using localStorage:', firebaseError);
                        // Fallback to localStorage with generated ID
                        const localId = 'local_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        newProduct = {
                            id: localId,
                            title,
                            description,
                            price,
                            image,
                            order: products.length + 1,
                            createdAt: new Date()
                        };
                        showToast('Firebase unavailable, saved locally', 'success');
                    }

                    products.push(newProduct);
                }

                // Save updated products to localStorage
                localStorage.setItem('products', JSON.stringify(products));

                renderProducts();
                document.getElementById('productModal').classList.add('hidden');
                currentEditingProduct = null;
            } catch (error) {
                console.error('Error saving product:', error);
                showToast('Error saving product. Please try again.', 'error');
            }
        });

        document.getElementById('cancelProductBtn').addEventListener('click', () => {
            document.getElementById('productModal').classList.add('hidden');
            currentEditingProduct = null;
        });

        // Web form event listeners
        document.getElementById('webForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const pageTitle = document.getElementById('pageTitle').value;
            const heroTitle = document.getElementById('heroTitle').value;
            const heroDescription = document.getElementById('heroDescription').value;
            const heroImage = document.getElementById('heroImage').value;

            if (saveWebContent(pageTitle, heroTitle, heroDescription, heroImage)) {
                document.getElementById('webModal').classList.add('hidden');
            }
        });

        document.getElementById('cancelWebBtn').addEventListener('click', () => {
            document.getElementById('webModal').classList.add('hidden');
        });

        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
            if (!document.getElementById('accountBtn').contains(e.target) &&
                !document.getElementById('adminMenu').contains(e.target)) {
                document.getElementById('adminMenu').classList.add('hidden');
            }
        });

        // Hamburger menu toggle
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        hamburgerBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Close mobile menu when clicking on a link
        mobileMenu.addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                mobileMenu.classList.add('hidden');
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!hamburgerBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                mobileMenu.classList.add('hidden');
            }
        });

        // Cart modal close
        const closeBtn = document.querySelector('.close');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                const cartModal = document.getElementById('cart-modal');
                if (cartModal) cartModal.style.display = 'none';
            });
        }

        // Popup click event
        document.getElementById('cart-popup').addEventListener('click', () => {
            const cartModal = document.getElementById('cart-modal');
            if (cartModal) cartModal.style.display = 'block';
        });

        // Initialize the app
        function init() {
            // Check if user is already logged in
            if (localStorage.getItem('isAdmin') === 'true') {
                isAdmin = true;
                showAdminMenu();
            }

            loadProducts();
            loadCart();
        }

        init();
    </script>
</body>
</html>
</content>
</create_file>

